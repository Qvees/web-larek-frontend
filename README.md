# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

## Структура проекта
- **src/**: исходные файлы проекта
  - **src/components/**: папка с JS компонентами
  - **src/components/base/**: папка с базовым кодом

## Важные файлы
- **src/pages/index.html**: HTML-файл главной страницы
- **src/types/types.ts**: файл с типами
- **src/index.ts**: точка входа приложения
- **src/scss/styles.scss**: корневой файл стилей
- **src/utils/constants.ts**: файл с константами
- **src/utils/utils.ts**: файл с утилитами
- **src/components/page.ts**: компонент для управления основным контентом страницы
- **src/components/common/Modal.ts**: компонент для работы с модальными окнами
- **src/components/card.ts**: компонент для отображения карточек товаров
- **src/components/common/Basket.ts**: компонент для управления корзиной покупок
- **src/components/ShopAPI.ts**: компонент для взаимодействия с API магазина
- **src/components/contacts.ts**: компонент для работы с контактными данными
- **src/components/Order.ts**: компонент для работы с формой заказа
- **src/components/AppData.ts**: компонент для управления состоянием приложения
- **src/components/Success.ts**: компонент для отображения сообщения об успешном отправление заказа

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура проекта

### Model (Модель):

- Класс Model
- Класс AppState
- Класс ShopAPI
- Класс Order

### View (Представление):
- Класс Component
- Класс Page
- Класс Modal
- Класс Basket
- Класс Card
- Класс Contacts
- Класс Success

### Описание данных

#### данные товара. IProduct:
interface IProduc{
    id: string, 
    description: string, 
    image: string, 
    title: string, 
    category: string, 
    price: number,
    error?:string 
}  
```
```
#### IOrderForm:
- Описывает интерфейс формы заказа.
- Содержит свойства:
    - email: Email для заказа (строка).
    - phone: Номер телефона для заказа (строка).
    - address: Адрес доставки (строка).
    - payment: Метод оплаты (тип PaymentMethod).

```
 
```
#### IOrder:
- Расширяет интерфейс IOrderForm.
- Добавляет свойства:
    - items: Массив строк, содержащий идентификаторы заказанных товаров.
    - total: Общая сумма заказа (число).

#### IOrderResult:
- Описывает интерфейс результата заказа.
- Содержит свойства:
    - id: Уникальный идентификатор заказа (строка).
    - total: Общая сумма заказа (число).

#### FormErrors:
- Тип, представляющий частичный набор ошибок формы.
- Используется для валидации формы заказа.

#### IAppState:
- Описывает состояние приложения.
- Содержит свойства:
    - catalog: Каталог продуктов.
    - basket: Массив строк, содержащий идентификаторы товаров в корзине.
    - preview: Идентификатор предпросмотра продукта.
    - order: Информация о текущем заказе.
    
#### IBasketItem:
- Описывает элемент корзины.
- Содержит свойства:
    - id: Уникальный идентификатор продукта.
    - title: Название продукта.
    - price: Цена продукта.

Эти типы используются для описания данных и состояния приложения, таких как продукты, заказы, корзина и формы.

____________________________________________________________________________________________________________________

### Слой Model (Модель):

#### Класс Model<T>:
- Model - абстрактный класс, который служит базовым для всех моделей.
- Конструктор принимает два аргумента:
    - data: объект типа T, который инициализирует свойства модели.
    - events: экземпляр IEvents, используемый для управления событиями.
- В конструкторе свойства модели инициализируются значениями из data с помощью Object.assign.
- Метод emitChanges используется для оповещения об изменениях в модели. Он принимает имя события event и необязательный параметр payload, который содержит дополнительные данные для передачи в событие.
- emitChanges вызывает метод emit экземпляра IEvents, чтобы оповестить об изменениях в модели.

#### Функция isModel:
- isModel - это функция, которая принимает объект в качестве аргумента и возвращает булево значение, указывающее, является ли этот объект экземпляром класса Model.
- Возвращает true, если объект является экземпляром Model, и false в противном случае.

#### Класс ProductItem:
- Наследует от Model<IProduct>:
- Model является базовым классом, который предоставляет основные методы для работы с моделью данных. ProductItem использует этот функционал для управления информацией о продукте.
- Свойства:
    - description, id, image, title, price, category: Хранят информацию о продукте, включая его описание, идентификатор, изображение, название, цену и категорию.
    - button: Опциональное свойство, представляющее собой ссылку на HTML-элемент кнопки.
__________________________________________________

### Класс AppState

Наследует от Model<IAppState>:
AppState также является моделью данных, предназначенной для хранения состояния приложения.

#### Свойства:
- **basket**: Массив строк, представляющий товары в корзине.
- **catalog**: Массив ProductItem, содержащий информацию о продуктах.
- **loading**: Логическое значение, указывающее на процесс загрузки данных.
- **order**: Объект, содержащий информацию о заказе, включая адрес, электронную почту, телефон, список товаров, общую сумму и способ оплаты.
- **preview**: Идентификатор предпросматриваемого продукта.
- **formErrors**: Объект, содержащий ошибки формы.

#### Методы:
- `toggleOrderedProduct(id: string, isIncluded: boolean)`: Добавляет или удаляет товар из заказа.
- `clearBasket()`: Очищает корзину.
- `getTotal()`: Вычисляет общую сумму заказа.
- `setCatalog(items: IProduct[])`: Устанавливает каталог продуктов.
- `setPreview(item: ProductItem)`: Устанавливает предпросматриваемый продукт.
- `setOrderField(field: keyof IOrderForm, value: 'online'|'offline')`: Устанавливает значения полей заказа.
- `getProducts()`: Возвращает продукты из каталога.
- `validateOrder()`: Проверяет правильность заполнения формы заказа.

---

### Класс Order

Наследует от Form<IOrderForm>:
Form является базовым классом для форм, который предоставляет функционал для работы с формами. Order использует этот функционал для управления данными формы заказа.

#### Свойства:
- **paymentMethod**: Свойство для хранения выбранного метода оплаты. Принимает значения 'online', 'offline'

#### Конструктор:
Принимает контейнер формы и объект событий events.
Инициализирует обработчики событий для кнопок "Далее", "Онлайн" и "При получении".

#### Методы:
- `updatePaymentButtons()`: Обновляет стили кнопок оплаты в зависимости от выбранного метода оплаты.
- `handleNextButtonClick()`: Обрабатывает нажатие кнопки "Далее". Проверяет, указан ли адрес и выбран ли способ оплаты, и отправляет событие о необходимости открытия формы контактов.
- `getPaymentMethod()`: Возвращает текущий выбранный метод оплаты.
- `set phone(value: string), set email(value: string), set address(value: string)`: Устанавливает значения телефона, email и адреса в соответствующие поля формы.

---

### Класс ShopAPI

Предоставляет методы для взаимодействия с API магазина. 

#### Интерфейс IShopAPI:
Описывает методы, которые должны быть реализованы в классе ShopAPI.
- `getProductList`: Получение списка продуктов.
- `getProductItem`: Получение информации о конкретном продукте.
- `orderProduct`: Оформление заказа.

#### Класс ShopAPI:
- Расширяет класс Api для работы с API.
- Содержит свойство cdn, представляющее URL-адрес контентного хранилища.
- В конструкторе принимает cdn, базовый URL и дополнительные параметры запроса.
- Метод `getProductItem(id: string)`: Отправляет запрос на получение информации о продукте с указанным идентификатором. Обрабатывает полученные данные, добавляя URL-адрес CDN к изображению продукта.
- Метод `getProductList()`: Отправляет запрос на получение списка продуктов. Также обрабатывает полученные данные, добавляя URL-адрес CDN к изображениям продуктов.
- Метод `orderProduct(order: IOrder)`: Отправляет запрос на оформление заказа с переданными данными. Возвращает результат заказа.
_________________________________________________________________________________________________________________________________________________

### View (Представление):

#### Класс Component

Класс Component представляет собой базовый компонент, который используется для создания других компонентов в приложении. 

**Конструктор:**
Принимает один аргумент - container, который представляет собой DOM-элемент, в который будет встраиваться компонент.
Код в конструкторе выполняется до всех объявлений в дочернем классе.

**Методы:**
- `toggleClass`: Переключает класс у указанного элемента.
- `setText`: Устанавливает текстовое содержимое указанного элемента.
- `setDisabled`: Устанавливает состояние блокировки указанного элемента.
- `setHidden`: Скрывает указанный элемент, устанавливая ему свойство display: none.
- `setVisible`: Показывает указанный элемент, удаляя свойство display: none.
- `setImage`: Устанавливает изображение для указанного элемента <img> с альтернативным текстом.
- `element`: Геттер, возвращающий корневой DOM-элемент компонента.
- `render`: Метод для рендеринга компонента, принимает объект data с данными для обновления компонента. Обновляет компонент, применяя данные из data.

*Абстрактный:*
Класс Component является абстрактным, что означает, что он не может быть создан напрямую, а только наследован.

---

#### Класс Page

Класс Page расширяет базовый класс Component<IPage>.

**Интерфейс IPage:**
Описывает структуру данных, ожидаемых для отображения на странице. Содержит счетчик, каталог элементов и флаг блокировки.

**Конструктор:**
Принимает контейнер страницы (HTMLElement) и объект событий (IEvents).
Инициализирует основные элементы страницы, такие как счетчик корзины, каталог товаров и обертка страницы.
При клике на корзину (_basket) генерирует событие "bids:open".

**Методы:**
- `setCounter`, `setCatalog`, `setLocked`: Устанавливают значения счетчика, каталога и флага блокировки страницы соответственно. Обновляют содержимое страницы в соответствии с переданными данными.

---

### Класс Modal

Класс `Modal` представляет модальное окно.

#### Архитектура класса:

- **Наследование**: Класс `Modal` наследуется от класса `Component`.

- **Конструктор**:
  - Принимает два аргумента: `container` - HTML-элемент, представляющий контейнер модального окна, и `events` - экземпляр `IEvents`, используемый для обработки событий.
  - Инициализирует свойства `_closeButton`, `_content` и `_addToBasketButton`.
  - Устанавливает обработчики событий на кнопку закрытия и клики вне контента модального окна для закрытия его.

- **Методы**:
  - `open()`: Открывает модальное окно и генерирует событие `modal:open`.
  - `close()`: Закрывает модальное окно, удаляет его содержимое и генерирует событие `modal:close`.
  - `render(data: IModalData)`: Вызывается для отображения модального окна с данными из объекта `data`.

#### Свойства класса:

- `_closeButton`: HTML-элемент кнопки закрытия модального окна.
- `_content`: HTML-элемент, который служит контейнером для содержимого модального окна.
- `_addToBasketButton`: HTML-элемент кнопки добавления в корзину.
```
```
#### Интерфейс IModalData:

```typescript
interface IModalData {
    content: HTMLElement;
}
```
Интерфейс IModalData определяет структуру данных, ожидаемых для использования в методе render класса Modal. Он содержит одно свойство content, которое должно быть HTML-элементом и представляет содержимое модального окна.
```
```
### Класс Form<T>

Класс `Form<T>` представляет форму веб-страницы.

#### Архитектура класса:

- **Наследование**: Класс `Form<T>` наследуется от класса `Component<IFormState>`.

- **Конструктор**:
  - Принимает два аргумента: `container` - HTML-элемент, представляющий форму, и `events` - экземпляр `IEvents`, используемый для обработки событий.
  - Инициализирует свойства `_submit` и `_errors`, представляющие кнопку отправки формы и контейнер для отображения ошибок, соответственно.
  - Устанавливает обработчики событий на ввод данных в форму и отправку формы.

- **Методы**:
  - `onInputChange(field: keyof T, value: string)`: Обработчик события ввода данных в форму, генерирует событие с изменением данных в форме.
  - `render(state: Partial<T> & IFormState)`: Вызывается для отображения формы с данными из объекта `state`.

#### Свойства класса:

- `_submit`: HTML-элемент кнопки отправки формы.
- `_errors`: HTML-элемент для отображения ошибок формы.
```
```

#### Интерфейс IFormState:
```typescript
interface IFormState {
    valid: boolean;
    errors: string[];
}
```
____________________________________________________________________________________________________________________

### Класс Basket:

Расширение от базового класса Component<IBasketView>:

Basket расширяет базовый класс Component<IBasketView>, что означает, что он является компонентом веб-приложения, который отображает содержимое корзины.

#### Интерфейс IBasketView:

IBasketView определяет интерфейс данных, которые использует компонент корзины. Включает в себя элементы, такие как items, total, selected, itemsInBasket.

#### Свойства класса Basket:

- _list, _total, _button, _orderButton, _counter: Это элементы DOM, представляющие различные части компонента корзины.
- itemsInBasket: Массив для хранения товаров в корзине.

#### Конструктор:

Принимает контейнер (элемент DOM) и экземпляр EventEmitter, который предоставляет механизм для обработки событий.
Инициализирует свойства компонента, находит необходимые элементы DOM и устанавливает обработчики событий.

#### Методы для работы с корзиной:

- set total(total: number): Устанавливает общую стоимость заказа.
- addItemToBasket(item: ProductItem): Добавляет товар в корзину.
- removeItemFromBasket(item: ProductItem): Удаляет товар из корзины.
- updateTotal(): Обновляет общую стоимость корзины.
- renderBasketItems(): Отображает товары в корзине.
- getItemsInBasket(): Возвращает товары, находящиеся в корзине.
- getItemId(): Возвращает идентификаторы товаров в корзине.
- clearBasket(): Очищает корзину.

#### Приватный метод updateCounter():

Обновляет счетчик товаров в корзине.

...

### Класс Card<T>

Класс `Card<T>` представляет карточку товара на веб-странице.

#### Интерфейсы и типы данных:
- ICardActions: Определяет действия, которые могут быть выполнены при взаимодействии с карточкой товара.
- ICard<T>: Описывает структуру данных карточки товара, включая заголовок, описание, изображение, категорию, цену и кнопку.

#### Архитектура класса:

- **Наследование**: Класс `Card<T>` наследуется от класса `Component<ICard<T>>`.

- **Конструктор**:
  - Принимает три аргумента: `blockName` - строка, представляющая имя блока, `container` - HTML-элемент, представляющий контейнер карточки, и `actions` - объект событий, связанных с карточкой.
  - Инициализирует свойства `_title`, `_image`, `_button`, `_description`, `_category` и `_price`, представляющие соответственно заголовок, изображение, кнопку, описание, категорию и цену карточки.
  - Устанавливает обработчики событий на кнопку карточки.

- **Методы**:
  - `id`: Получает устанавливает идентификатор карточки.
  - `title`: Получает устанавливает заголовок карточки.
  - `category`: Получает устанавливает категорию карточки.
  - `price`: Получает устанавливает цену карточки.
  - `image`: Устанавливает изображение карточки.
  - `description`: Получает устанавливает описание карточки.

#### Интерфейс ICard<T>:

```typescript
interface ICard<T> {
    title: string;
    description?: string | string[];
    image: string;
    category: string;
    price: number;
    button?: HTMLButtonElement;
}
```
#### Класс CatalogItem:

Расширяет класс Card<IProductList> и представляет карточку товара из каталога.
- Конструктор принимает контейнер (DOM-элемент, содержащий карточку) и действия.
```
```

### Класс Contacts

Класс `Contacts` представляет форму для ввода контактной информации, наследуемую от класса `Form<IOrderForm>`.

#### Архитектура класса:

- **Наследование**: Класс `Contacts` наследуется от класса `Form<IOrderForm>`.

- **Конструктор**:
  - Принимает два аргумента: `container` - HTML-элемент, представляющий контейнер формы, и `events` - экземпляр `IEvents`, используемый для обработки событий.
  - Инициализирует приватные свойства `_email` и `_phone` для хранения электронной почты и номера телефона.
  - Добавляет обработчики событий для полей ввода телефона и электронной почты, а также для кнопки "Оплатить".

- **Методы**:
  - `checkSubmitButtonState()`: Проверяет состояние кнопки "Оплатить" в зависимости от введенных данных.
  - `set phone(value: string)`: Устанавливает значение телефона.
  - `set email(value: string)`: Устанавливает значение электронной почты.
  - `getEmail()`: Возвращает значение электронной почты.
  - `getPhone()`: Возвращает значение телефона.

#### Интерфейс IOrderForm:

```typescript
interface IOrderForm {
    email: string;
    phone: string;
    address: string;
}

```
#### Основной файл `index.ts`

Файл `index.ts` является главным файлом проекта. В нем осуществляется инициализация приложения, управление компонентами, 
взаимодействие с API и обработка событий.

#### Инициализация зависимостей

Файл начинается с импорта необходимых зависимостей, таких как стили, API-модули, константы, компоненты и утилиты.

#### Создание экземпляров классов и компонентов
Далее происходит создание экземпляров классов, необходимых для функционирования приложения, таких как:
- `EventEmitter`, используемый для управления событиями;
- `ShopAPI`, предоставляющий методы для взаимодействия с сервером;
- `AppState`, управляющий состоянием приложения;
- `Page`, отвечающий за отображение основного контента страницы;
- `Modal`, управляющий модальными окнами.

#### Обработка событий и взаимодействие с API

В файле определены обработчики событий для различных событий, таких как открытие и закрытие модального окна, изменение каталога товаров и другие. Также реализовано взаимодействие с сервером через API для загрузки данных о товарах, обработки оформления заказа и отправки информации на сервер.

#### Описание

Файл `index.ts` является центральной частью приложения, обеспечивающей его работоспособность и функциональность. Он объединяет в себе различные компоненты, управляет логикой приложения и взаимодействием с внешними источниками данных.
